<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ink.radiant.query.mapper.PostQueryMapper">

    <resultMap id="PostQueryModelResultMap" type="ink.radiant.query.model.PostQueryModel">
        <id property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="body" column="body"/>
        <result property="translatedTitle" column="translated_title"/>
        <result property="originalSentences" column="original_sentences"/>
        <result property="translatedSentences" column="translated_sentences"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="likes" column="likes"/>
        <result property="commentsCount" column="comments_count"/>
        <result property="thumbnailUrl" column="thumbnail_url"/>
        <result property="authorId" column="author_id"/>
        <result property="deletedAt" column="deleted_at"/>
    </resultMap>

    <select id="findAllOrderByCreatedAtDesc" resultMap="PostQueryModelResultMap">
        SELECT id, title, body, translated_title, original_sentences, translated_sentences,
               created_at, updated_at, likes, comments_count, thumbnail_url, author_id, deleted_at
        FROM posts
        WHERE deleted_at IS NULL
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>

    <select id="findAllAfterCursor" resultMap="PostQueryModelResultMap">
        SELECT id, title, body, translated_title, original_sentences, translated_sentences,
               created_at, updated_at, likes, comments_count, thumbnail_url, author_id, deleted_at
        FROM posts
        WHERE deleted_at IS NULL AND created_at <![CDATA[<]]> #{cursor}
        ORDER BY created_at DESC
        LIMIT #{limit}
    </select>

    <select id="findByIdAndNotDeleted" resultMap="PostQueryModelResultMap">
        SELECT id, title, body, translated_title, original_sentences, translated_sentences,
               created_at, updated_at, likes, comments_count, thumbnail_url, author_id, deleted_at
        FROM posts
        WHERE id = #{id} AND deleted_at IS NULL
    </select>

    <select id="countExistingPosts" resultType="long">
        SELECT COUNT(*)
        FROM posts
        WHERE deleted_at IS NULL
    </select>

</mapper>